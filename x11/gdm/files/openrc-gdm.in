#!/sbin/openrc-run

name="gdm"
command="/usr/local/sbin/${name}"
pidfile="/var/run/${name}.pid"
start_stop_daemon_args="-m --background"

depend() {
        provide gdb
        use moused hald dbus syscons
}

start_pre()
{
    while ! ps -axoargs | grep "^/usr/libexec/getty " | grep -qv grep >/dev/null 2>&1; do
        if [ ${iter} -eq 60 ]; then
            break
        fi
        sleep 1
        iter=$(expr ${iter} + 1)
    done
    iter=0
    while ! /usr/local/bin/lshal >/dev/null 2>&1 ; do
        if [ ${iter} -eq 60 ]; then
            break
        fi
        sleep 1
        iter=$(expr ${iter} + 1)
    done
}

stop_pre()
{
    pkill -9 -u gdm
    pkill -9 X
    pkill -9 gdm-session-worker
}

stop_post()
{
    killall Xorg
}
